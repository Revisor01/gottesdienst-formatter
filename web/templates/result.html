{% extends "base.html" %}

{% block title %}Ergebnis - Gottesdienst-Formatter{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card mt-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Formatierte Gottesdiensttermine</h4>
                <span class="badge bg-light text-dark">{{ count }} Termine verarbeitet</span>
            </div>
            <div class="card-body">
                <div class="alert alert-success">
                    <strong>Erfolgreich!</strong> 
                    {% if source == 'ChurchDesk' %}
                        Die ChurchDesk Events wurden erfolgreich verarbeitet und in das Boyens Medien Format konvertiert.
                    {% else %}
                        Die Excel-Datei wurde erfolgreich verarbeitet und in das Boyens Medien Format konvertiert.
                    {% endif %}
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <form method="POST" action="{{ url_for('download_file') }}">
                            <input type="hidden" name="formatted_text" value="{{ formatted_text }}">
                            <button type="submit" class="btn btn-primary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7,10 12,15 17,10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Als .txt Datei herunterladen
                            </button>
                        </form>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <button type="button" class="btn btn-outline-secondary" onclick="copyToClipboard()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            In Zwischenablage kopieren
                        </button>
                    </div>
                </div>
                
                <div class="result-box" id="resultText">{{ formatted_text }}</div>
                
                <div class="mt-3 text-center">
                    <a href="{{ url_for('index') }}" class="btn btn-secondary">
                        Neue Datei verarbeiten
                    </a>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Nächste Schritte</h5>
            </div>
            <div class="card-body">
                <ol>
                    <li>Text kopieren oder als Datei herunterladen</li>
                    <li>An <strong>redaktion@boyens-medien.de</strong> senden</li>
                    <li>Deadline beachten: <strong>bis zum 20. des Vormonats</strong></li>
                </ol>
                
                <div class="alert alert-info mt-3">
                    <strong>Hinweis:</strong> Das Format entspricht exakt den Vorgaben von Boyens Medien. 
                    Termine sind nach Datum sortiert und im korrekten Fließtext-Format dargestellt.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard() {
    const text = document.getElementById('resultText').textContent;
    navigator.clipboard.writeText(text).then(function() {
        // Erfolg-Feedback
        const button = event.target.closest('button');
        const originalText = button.innerHTML;
        button.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2"><polyline points="20,6 9,17 4,12"></polyline></svg>Kopiert!';
        button.classList.remove('btn-outline-secondary');
        button.classList.add('btn-success');
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-secondary');
        }, 2000);
    }, function(err) {
        alert('Fehler beim Kopieren: ' + err);
    });
}
</script>
{% endblock %}